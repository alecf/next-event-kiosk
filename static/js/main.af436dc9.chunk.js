(this["webpackJsonpnext-event-kiosk"]=this["webpackJsonpnext-event-kiosk"]||[]).push([[0],{13:function(e,t,n){e.exports=n(22)},18:function(e,t,n){},22:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(10),c=n.n(o),i=(n(18),n(6)),l=n(5),u=n(2),s=n.n(u),d=n(4),p=n(1),f=n(11),m=n.n(f),v=n(24),g=n(12),b=n.n(g),O=n(7),w=n.n(O),j=n(8),h=n.n(j),k=n(3),S=n.n(k);function _(e,t){var n=Object(a.useRef)(),r=Object(a.useRef)(e),o=Object(a.useCallback)((function(e){0!==r.current?(t(e),n.current=void 0,setTimeout((function(){n.current=requestAnimationFrame(o)}),r.current)):console.log("all done, interval is 0",r.current)}),[t]);Object(a.useEffect)((function(){r.current=e}),[e]),Object(a.useEffect)((function(){return n.current=requestAnimationFrame(o),function(){n.current&&cancelAnimationFrame(n.current)}}),[o])}function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=0;return new Promise((function(r,o){var c=!1;!function i(){a+=1;try{c=e()}catch(l){o(l)}c?r():(console.log("not loaded...waiting",t),n&&a>n?o(new Error("Retried ".concat(a," times"))):setTimeout(i,t))}()}))}function y(e,t){return x.apply(this,arguments)}function x(){return(x=Object(d.a)(s.a.mark((function e(t,n){var a,r,o,c=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=function(){return new Promise((function(e,a){gapi.load("client",(function(){return e(I(t,n))}))}))},a=c.length>2&&void 0!==c[2]?c[2]:5,o=0;case 3:if(!(o<a)){e.next=17;break}return e.prev=4,console.log("loading calendar.."),e.next=8,r();case 8:return e.abrupt("return");case 11:e.prev=11,e.t0=e.catch(4),console.error("Attempt ".concat(o+1," of ").concat(a,": failed to load calendar: "),e.t0);case 14:o++,e.next=3;break;case 17:case"end":return e.stop()}}),e,null,[[4,11]])})))).apply(this,arguments)}function I(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2e3,a=200;return new Promise(function(){var r=Object(d.a)(s.a.mark((function r(o,c){return s.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,gapi.client.init({apiKey:e,clientId:t,discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],scope:N}),r.next=4,E((function(){return!!gapi.client.calendar}),200,n/a);case 4:console.log("have calendar api"),o(null),r.next=12;break;case 8:r.prev=8,r.t0=r.catch(0),console.error("Error loading calendar",r.t0),c(r.t0);case 12:case"end":return r.stop()}}),r,null,[[0,8]])})));return function(e,t){return r.apply(this,arguments)}}())}function A(e,t){var n=window.localStorage.getItem(e),r=null!==n?JSON.parse(n):t,o=Object(a.useState)(r),c=Object(p.a)(o,2),i=c[0],l=c[1];return[i,Object(a.useCallback)((function(t){l(t),window.localStorage.setItem(e,JSON.stringify(t))}),[e])]}var L,C=null!==(L="1092541901902-bi1rq3v07bajn6jeaatb3hgaepbjsm7t.apps.googleusercontent.com")?L:"",N="https://www.googleapis.com/auth/calendar.events.readonly https://www.googleapis.com/auth/calendar.readonly",T=function(){var e,t=Object(a.useState)(window.localStorage.getItem("gapi_token")),n=Object(p.a)(t,2),o=n[0],c=n[1],l=Object(a.useState)(),u=Object(p.a)(l,2),f=u[0],m=u[1],v=Object(a.useState)(),g=Object(p.a)(v,2),j=g[0],k=g[1],E=Object(a.useState)(),x=Object(p.a)(E,2),I=x[0],L=x[1],T=function(){var e=Object(a.useState)(!1),t=Object(p.a)(e,2),n=t[0],r=t[1],o=Object(a.useState)("start"),c=Object(p.a)(o,2),i=c[0],l=c[1],u=Object(a.useCallback)((function(){n||l("key-".concat(Math.random()))}),[n]);return _(n?0:3e3,u),{setGLoginLoaded:r,loginRenderKey:i}}(),F=T.loginRenderKey,B=T.setGLoginLoaded,H=function(e,t,n){var r=Object(a.useState)(!1),o=Object(p.a)(r,2),c=o[0],i=o[1];return Object(a.useEffect)((function(){function a(){return(a=Object(d.a)(s.a.mark((function a(){return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,console.log("loading calendar for ",n),a.next=4,y(e,t);case 4:console.log("have calendar"),i(!0),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),console.log("failed to get calendar");case 11:case"end":return a.stop()}}),a,null,[[0,8]])})))).apply(this,arguments)}n&&t&&function(){a.apply(this,arguments)}()}),[e,t,i,n]),c}("AIzaSyD01PlE0xERSwpZQauir8ZisF5e7LuNAbo",C,j),Z=Object(a.useCallback)((function(e){console.log("onSuccess","tokenId"in e?e.tokenId:e),B(!0),"tokenId"in e&&(console.log("response: ",e),window.localStorage.setItem("gapi_token",e.tokenId),k(e.profileObj))}),[B]),P=Object(a.useCallback)((function(e){B(!0),console.log("failure: ",e),m(e)}),[B]),q=A("current_events",null),G=Object(p.a)(q,2),K=G[0],z=G[1],U=A("calendarId",""),W=Object(p.a)(U,2),Q=W[0],X=W[1],$=Object(a.useCallback)((function(){c(null),k(null),window.localStorage.removeItem("gapi_token")}),[]),V=Object(a.useCallback)(Object(d.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,gapi.client.calendar.calendarList.list();case 2:t=e.sent,L(t.result);case 4:case"end":return e.stop()}}),e)}))),[]),Y=Object(a.useCallback)(function(){var e=Object(d.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return X(t),e.next=3,gapi.client.calendar.events.list(M(t));case 3:n=e.sent,z(n.result),L(null);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[X,z]);!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(a.useRef)(),r=Object(a.useCallback)((function(){var e=n.current;e&&(n.current=void 0,clearTimeout(e))}),[n]);Object(a.useEffect)((function(){return n.current=setTimeout(e,t),r}),[e,t,r])}(Object(a.useCallback)((function(){Q&&Y(Q)}),[Q,Y]),3600);var ee=function(){var e=Object(a.useState)(D),t=Object(p.a)(e,2),n=t[0],r=t[1];return _(1e3,Object(a["useCallback"])((function(){r(new Date)}),[])),n}(),te=Object(a.useMemo)((function(){return function(e,t){var n,a,r=e.toISOString(),o=null!==(n=null===t||void 0===t||null===(a=t.items)||void 0===a?void 0:a.map((function(t){var n,a=t.start,o=t.end;if(!(null===a||void 0===a?void 0:a.dateTime))return null;var c=new Date(a.dateTime),l=c.toISOString(),u=new Date(null!==(n=null===o||void 0===o?void 0:o.dateTime)&&void 0!==n?n:""),s=u.toISOString();if(r>s||c.getDay()!==e.getDay())return null;var d=l<=r&&r<s,p=!d&&s>r,f=Math.floor((c.valueOf()-e.valueOf())/1e3),m=Math.floor((u.valueOf()-e.valueOf())/1e3);return Object(i.a)(Object(i.a)({},t),{},{happeningNow:d,pending:p,secondsLeftStart:f,secondsLeftEnd:m,ago:h()(c)})})).filter(J))&&void 0!==n?n:[],c=b.a.partition(o,(function(e){return e.happeningNow})),l=Object(p.a)(c,2),u=l[0],s=l[1];return{current:u,future:s.slice(0,3)}}(ee,K)}),[K,ee]),ne=te.current,ae=te.future;return r.a.createElement("div",{className:S.a.app},r.a.createElement("header",{className:S.a.header},r.a.createElement("h1",{className:S.a.time},null===ee||void 0===ee?void 0:ee.toLocaleTimeString()),f&&r.a.createElement("div",null,"Error:"," ",r.a.createElement("pre",{style:{fontSize:"12px"}},JSON.stringify(f))),I&&r.a.createElement("ul",null,null===(e=I.items)||void 0===e?void 0:e.map((function(e){return r.a.createElement("li",{key:e.id},r.a.createElement("button",{onClick:function(){var t;return Y(null!==(t=e.id)&&void 0!==t?t:"")}},e.summary))}))),!!(null===ne||void 0===ne?void 0:ne.length)&&r.a.createElement("div",null,r.a.createElement("h2",{className:S.a.timeHeader},"Right now"),r.a.createElement("ul",null,ne.map((function(e){return r.a.createElement(R,{key:e.id,event:e})})))),!!(null===ae||void 0===ae?void 0:ae.length)&&r.a.createElement("div",null,r.a.createElement("h2",{className:S.a.timeHeader},"Coming up"),r.a.createElement("ul",null,ae.map((function(e){return r.a.createElement(R,{key:e.id,event:e})})))),r.a.createElement("div",null,j&&r.a.createElement("div",null,"User: ",j.name),r.a.createElement(w.a,{key:F,clientId:C,buttonText:"Login",onSuccess:Z,onFailure:P,isSignedIn:!0,uxMode:"redirect",scope:N}),o&&r.a.createElement(O.GoogleLogout,{clientId:C,onLogoutSuccess:$}),r.a.createElement("button",{onClick:V,disabled:!H},"Load calendar"))))},D=new Date,R=function(e){var t,n,o,c,i,u=e.event,s=u.secondsLeftStart<3600,d=u.secondsLeftStart<300,p=m()((t={},Object(l.a)(t,S.a.now,u.happeningNow),Object(l.a)(t,S.a.soon,s&&!d),Object(l.a)(t,S.a.imminent,d),t),S.a.banner),f=Object(v.a)(new Date(null!==(n=null===(o=u.start)||void 0===o?void 0:o.dateTime)&&void 0!==n?n:""),"h:mm"),g=h()(new Date(null!==(c=null===(i=u.end)||void 0===i?void 0:i.dateTime)&&void 0!==c?c:""));return r.a.createElement("li",{key:u.id,className:p,"data-secondsLeft":u.secondsLeftStart,"data-minutesLeft":u.secondsLeftStart/60},u.summary," ",u.pending?u.ago:null,u.pending&&r.a.createElement(a.Fragment,null," @","\xa0",f),r.a.createElement("div",{className:S.a.note},u.happeningNow&&" ending ".concat(g)))};function M(e){return console.log("filtering by ",(new Date).toISOString()),{calendarId:e,timeMin:(new Date).toISOString(),showDeleted:!1,singleEvents:!0,maxResults:10,orderBy:"startTime"}}function J(e){return null!==e&&void 0!==e}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(T,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},3:function(e,t,n){e.exports={app:"App_app__1kX79",logo:"App_logo__1ItuU",time:"App_time__Mwxyj",header:"App_header__3ZZ1n",link:"App_link__TB6Cl",banner:"App_banner__29E-O",soon:"App_soon__1HASJ",imminent:"App_imminent__3j97Z",now:"App_now__19jbL",timeHeader:"App_timeHeader__3vLT2",note:"App_note__3pgJB","App-logo-spin":"App_App-logo-spin__1e7sv"}}},[[13,1,2]]]);
//# sourceMappingURL=main.af436dc9.chunk.js.map