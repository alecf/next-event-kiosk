(this["webpackJsonpnext-event-kiosk"]=this["webpackJsonpnext-event-kiosk"]||[]).push([[0],{13:function(e,t,n){e.exports=n(22)},18:function(e,t,n){},22:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),c=n(10),i=n.n(c),l=(n(18),n(5)),u=n(6),s=n(2),d=n.n(s),p=n(4),f=n(1),m=n(11),v=n.n(m),g=n(24),b=n(12),O=n.n(b),w=n(7),h=n.n(w),j=n(8),_=n.n(j),S=n(3),k=n.n(S);function E(e,t){var n=Object(r.useRef)(),a=Object(r.useRef)(e),o=Object(r.useCallback)((function(e){0!==a.current?(t(e),n.current=void 0,setTimeout((function(){n.current=requestAnimationFrame(o)}),a.current)):console.log("all done, interval is 0",a.current)}),[t]);Object(r.useEffect)((function(){a.current=e}),[e]),Object(r.useEffect)((function(){return n.current=requestAnimationFrame(o),function(){n.current&&cancelAnimationFrame(n.current)}}),[o])}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=0;return new Promise((function(r,o){var c=!1;!function i(){a+=1;try{c=e()}catch(l){o(l)}c?r():(console.log("not loaded...waiting",t),n&&a>n?o(new Error("Retried ".concat(a," times"))):setTimeout(i,t))}()}))}function I(e,t){return L.apply(this,arguments)}function L(){return(L=Object(p.a)(d.a.mark((function e(t,n){var a,r,o,c=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=function(){return new Promise((function(e,a){gapi.load("client",(function(){return e(x(t,n))}))}))},a=c.length>2&&void 0!==c[2]?c[2]:5,o=0;case 3:if(!(o<a)){e.next=17;break}return e.prev=4,console.log("loading calendar.."),e.next=8,r();case 8:return e.abrupt("return");case 11:e.prev=11,e.t0=e.catch(4),console.error("Attempt ".concat(o+1," of ").concat(a,": failed to load calendar: "),e.t0);case 14:o++,e.next=3;break;case 17:case"end":return e.stop()}}),e,null,[[4,11]])})))).apply(this,arguments)}function x(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2e3,a=200;return new Promise(function(){var r=Object(p.a)(d.a.mark((function r(o,c){return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,gapi.client.init({apiKey:e,clientId:t,discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],scope:T}),r.next=4,y((function(){return!!gapi.client.calendar}),200,n/a);case 4:console.log("have calendar api"),o(null),r.next=12;break;case 8:r.prev=8,r.t0=r.catch(0),console.error("Error loading calendar",r.t0),c(r.t0);case 12:case"end":return r.stop()}}),r,null,[[0,8]])})));return function(e,t){return r.apply(this,arguments)}}())}var A=null!==(a=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_CLIENT_ID)&&void 0!==a?a:"",T="https://www.googleapis.com/auth/calendar.events.readonly https://www.googleapis.com/auth/calendar.readonly",C=function(){var e,t=Object(r.useState)(window.localStorage.getItem("gapi_token")),n=Object(f.a)(t,2),a=n[0],c=n[1],i=Object(r.useState)(),u=Object(f.a)(i,2),s=u[0],m=u[1],v=Object(r.useState)(),g=Object(f.a)(v,2),b=g[0],j=g[1],S=Object(r.useState)(),y=Object(f.a)(S,2),L=y[0],x=y[1],C=function(){var e=Object(r.useState)(!1),t=Object(f.a)(e,2),n=t[0],a=t[1],o=Object(r.useState)("start"),c=Object(f.a)(o,2),i=c[0],l=c[1],u=Object(r.useCallback)((function(){n||l("key-".concat(Math.random()))}),[n]);return E(n?0:3e3,u),{setGLoginLoaded:a,loginRenderKey:i}}(),M=C.loginRenderKey,F=C.setGLoginLoaded,H=function(e,t,n){var a=Object(r.useState)(!1),o=Object(f.a)(a,2),c=o[0],i=o[1];return Object(r.useEffect)((function(){function a(){return(a=Object(p.a)(d.a.mark((function a(){return d.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,console.log("loading calendar for ",n),a.next=4,I(e,t);case 4:console.log("have calendar"),i(!0),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),console.log("failed to get calendar");case 11:case"end":return a.stop()}}),a,null,[[0,8]])})))).apply(this,arguments)}n&&t&&function(){a.apply(this,arguments)}()}),[e,t,i,n]),c}("AIzaSyD01PlE0xERSwpZQauir8ZisF5e7LuNAbo",A,b),J=Object(r.useCallback)((function(e){console.log("onSuccess","tokenId"in e?e.tokenId:e),F(!0),"tokenId"in e&&(console.log("response: ",e),window.localStorage.setItem("gapi_token",e.tokenId),j(e.profileObj))}),[F]),B=Object(r.useCallback)((function(e){F(!0),console.log("failure: ",e),m(e)}),[F]),K=function(e,t){var n=window.localStorage.getItem(e),a=null!==n?JSON.parse(n):t,o=Object(r.useState)(a),c=Object(f.a)(o,2),i=c[0],l=c[1];return[i,Object(r.useCallback)((function(t){l(t),window.localStorage.setItem(e,JSON.stringify(t))}),[e])]}("current_events",null),W=Object(f.a)(K,2),Z=W[0],G=W[1],U=Object(r.useCallback)((function(){c(null),j(null),window.localStorage.removeItem("gapi_token")}),[]),q=Object(r.useCallback)(Object(p.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,gapi.client.calendar.calendarList.list();case 2:t=e.sent,x(t.result);case 4:case"end":return e.stop()}}),e)}))),[]),z=Object(r.useCallback)(function(){var e=Object(p.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,gapi.client.calendar.events.list(R(t));case 2:n=e.sent,G(n.result),x(null);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[G]),Q=function(){var e=Object(r.useState)(D),t=Object(f.a)(e,2),n=t[0],a=t[1];return E(1e3,Object(r["useCallback"])((function(){a(new Date)}),[])),n}(),V=Object(r.useMemo)((function(){return function(e,t){var n,a,r=e.toISOString(),o=null!==(n=null===t||void 0===t||null===(a=t.items)||void 0===a?void 0:a.map((function(t){var n,a=t.start,o=t.end;if(!(null===a||void 0===a?void 0:a.dateTime))return null;var c=new Date(a.dateTime),i=c.toISOString(),u=new Date(null!==(n=null===o||void 0===o?void 0:o.dateTime)&&void 0!==n?n:""),s=u.toISOString();if(r>s||c.getDay()!==e.getDay())return null;var d=i<=r&&r<s,p=!d&&s>r,f=Math.floor((c.valueOf()-e.valueOf())/1e3),m=Math.floor((u.valueOf()-e.valueOf())/1e3);return Object(l.a)(Object(l.a)({},t),{},{happeningNow:d,pending:p,secondsLeftStart:f,secondsLeftEnd:m,ago:_()(c)})})).filter(P))&&void 0!==n?n:[],c=O.a.partition(o,(function(e){return e.happeningNow})),i=Object(f.a)(c,2),u=i[0],s=i[1];return{current:u,future:s.slice(0,3)}}(Q,Z)}),[Z,Q]),X=V.current,$=V.future;return function(e,t){var n=Object(r.useRef)({});Object(r.useEffect)((function(){if(n.current){var a=Object.keys(Object(l.a)(Object(l.a)({},n.current),t)),r={};a.forEach((function(e){n.current[e]!==t[e]&&(r[e]={from:n.current[e],to:t[e]})})),Object.keys(r).length&&console.log("[why-did-you-update]",e,r)}n.current=t}))}("GoogleLogin",{key:M,clientId:A,onSuccess:J,onFailure:B,scope:T}),o.a.createElement("div",{className:k.a.app},o.a.createElement("header",{className:k.a.header},o.a.createElement("h1",{className:k.a.time},null===Q||void 0===Q?void 0:Q.toLocaleTimeString()),s&&o.a.createElement("div",null,"Error:"," ",o.a.createElement("pre",{style:{fontSize:"12px"}},JSON.stringify(s))),L&&o.a.createElement("ul",null,null===(e=L.items)||void 0===e?void 0:e.map((function(e){return o.a.createElement("li",{key:e.id},o.a.createElement("button",{onClick:function(){var t;return z(null!==(t=e.id)&&void 0!==t?t:"")}},e.summary))}))),!!(null===X||void 0===X?void 0:X.length)&&o.a.createElement("div",null,o.a.createElement("h2",{className:k.a.timeHeader},"Right now"),o.a.createElement("ul",null,X.map((function(e){return o.a.createElement(N,{key:e.id,event:e})})))),!!(null===$||void 0===$?void 0:$.length)&&o.a.createElement("div",null,o.a.createElement("h2",{className:k.a.timeHeader},"Coming up"),o.a.createElement("ul",null,$.map((function(e){return o.a.createElement(N,{key:e.id,event:e})})))),o.a.createElement("div",null,b&&o.a.createElement("div",null,"User: ",b.name),o.a.createElement(h.a,{key:M,clientId:A,buttonText:"Login",onSuccess:J,onFailure:B,isSignedIn:!0,uxMode:"redirect",scope:T}),a&&o.a.createElement(w.GoogleLogout,{clientId:A,onLogoutSuccess:U}),o.a.createElement("button",{onClick:q,disabled:!H},"Load calendar"))))},D=new Date,N=function(e){var t,n,a,c,i,l=e.event,s=l.secondsLeftStart<3600,d=l.secondsLeftStart<300,p=v()((t={},Object(u.a)(t,k.a.now,l.happeningNow),Object(u.a)(t,k.a.soon,s&&!d),Object(u.a)(t,k.a.imminent,d),t),k.a.banner),f=Object(g.a)(new Date(null!==(n=null===(a=l.start)||void 0===a?void 0:a.dateTime)&&void 0!==n?n:""),"h:mm"),m=_()(new Date(null!==(c=null===(i=l.end)||void 0===i?void 0:i.dateTime)&&void 0!==c?c:""));return o.a.createElement("li",{key:l.id,className:p,"data-secondsLeft":l.secondsLeftStart,"data-minutesLeft":l.secondsLeftStart/60},l.summary," ",l.pending?l.ago:null,l.pending&&o.a.createElement(r.Fragment,null," @","\xa0",f),o.a.createElement("div",{className:k.a.note},l.happeningNow&&" ending ".concat(m)))};function R(e){return console.log("filtering by ",(new Date).toISOString()),{calendarId:e,timeMin:(new Date).toISOString(),showDeleted:!1,singleEvents:!0,maxResults:10,orderBy:"startTime"}}function P(e){return null!==e&&void 0!==e}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(C,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},3:function(e,t,n){e.exports={app:"App_app__1kX79",logo:"App_logo__1ItuU",time:"App_time__Mwxyj",header:"App_header__3ZZ1n",link:"App_link__TB6Cl",banner:"App_banner__29E-O",soon:"App_soon__1HASJ",imminent:"App_imminent__3j97Z",now:"App_now__19jbL",timeHeader:"App_timeHeader__3vLT2",note:"App_note__3pgJB","App-logo-spin":"App_App-logo-spin__1e7sv"}}},[[13,1,2]]]);
//# sourceMappingURL=main.e6870ea1.chunk.js.map